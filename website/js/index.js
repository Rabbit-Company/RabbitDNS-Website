var servers = [{"name":"TIA","latitude":41.4146995544,"longitude":19.7206001282},{"name":"ALG","latitude":36.6910018921,"longitude":3.2154099941},{"name":"LAD","latitude":-8.8583698273,"longitude":13.2312002182},{"name":"EZE","latitude":-34.8222,"longitude":-58.5358},{"name":"COR","latitude":-31.31,"longitude":-64.208333},{"name":"NQN","latitude":-38.9490013123,"longitude":-68.1557006836},{"name":"EVN","latitude":40.1473007202,"longitude":44.3959007263},{"name":"ADL","latitude":-34.9431729,"longitude":138.5335637},{"name":"BNE","latitude":-27.3841991425,"longitude":153.117004394},{"name":"CBR","latitude":-35.3069000244,"longitude":149.1950073242},{"name":"HBA","latitude":-42.883209,"longitude":147.331665},{"name":"MEL","latitude":-37.6733016968,"longitude":144.843002319},{"name":"PER","latitude":-31.9402999878,"longitude":115.967002869},{"name":"SYD","latitude":-33.9460983276,"longitude":151.177001953},{"name":"VIE","latitude":48.1102981567,"longitude":16.5697002411},{"name":"LLK","latitude":38.7463989258,"longitude":48.8180007935},{"name":"GYD","latitude":40.4674987793,"longitude":50.0466995239},{"name":"BAH","latitude":26.2707996368,"longitude":50.6335983276},{"name":"CGP","latitude":22.2495995,"longitude":91.8133011},{"name":"DAC","latitude":23.843347,"longitude":90.397783},{"name":"JSR","latitude":23.1837997437,"longitude":89.1607971191},{"name":"MSQ","latitude":53.9006,"longitude":27.599},{"name":"BRU","latitude":50.9014015198,"longitude":4.4844398499},{"name":"PBH","latitude":27.4712,"longitude":89.6339},{"name":"GBE","latitude":-24.6282,"longitude":25.9231},{"name":"QWJ","latitude":-22.738,"longitude":-47.334},{"name":"BEL","latitude":-1.4563,"longitude":-48.5013},{"name":"CNF","latitude":-19.624444,"longitude":-43.971944},{"name":"BNU","latitude":-26.89245,"longitude":-49.07696},{"name":"BSB","latitude":-15.79824,"longitude":-47.90859},{"name":"CFC","latitude":-26.7762,"longitude":-51.0125},{"name":"VCP","latitude":-22.90662,"longitude":-47.08576},{"name":"CGB","latitude":-15.59611,"longitude":-56.09667},{"name":"CWB","latitude":-25.5284996033,"longitude":-49.1758003235},{"name":"FLN","latitude":-27.6702785492,"longitude":-48.5525016785},{"name":"FOR","latitude":-3.7762799263,"longitude":-38.5326004028},{"name":"GYN","latitude":-16.69727,"longitude":-49.26851},{"name":"ITJ","latitude":-27.6116676331,"longitude":-48.6727790833},{"name":"JOI","latitude":-26.304408,"longitude":-48.846383},{"name":"JDO","latitude":-7.2242,"longitude":-39.313},{"name":"MAO","latitude":-3.11286,"longitude":-60.01949},{"name":"POA","latitude":-29.9944000244,"longitude":-51.1713981628},{"name":"REC","latitude":-8.1264896393,"longitude":-34.9235992432},{"name":"RAO","latitude":-21.1363887787,"longitude":-47.7766685486},{"name":"GIG","latitude":-22.8099994659,"longitude":-43.2505569458},{"name":"SSA","latitude":-12.9086112976,"longitude":-38.3224983215},{"name":"SJP","latitude":-20.807157,"longitude":-49.378994},{"name":"GRU","latitude":-23.4355564117,"longitude":-46.4730567932},{"name":"SOD","latitude":-23.54389,"longitude":-46.63445},{"name":"NVT","latitude":-26.8251,"longitude":-49.2695},{"name":"UDI","latitude":-18.8836116791,"longitude":-48.225276947},{"name":"BWN","latitude":4.903052,"longitude":114.939819},{"name":"SOF","latitude":42.6966934204,"longitude":23.4114360809},{"name":"OUA","latitude":12.3531999588,"longitude":-1.5124200583},{"name":"PNH","latitude":11.5466003418,"longitude":104.84400177},{"name":"YYC","latitude":51.113899231,"longitude":-114.019996643},{"name":"YVR","latitude":49.193901062,"longitude":-123.183998108},{"name":"YWG","latitude":49.9099998474,"longitude":-97.2398986816},{"name":"YOW","latitude":45.3224983215,"longitude":-75.6691970825},{"name":"YYZ","latitude":43.6772003174,"longitude":-79.6305999756},{"name":"YUL","latitude":45.4706001282,"longitude":-73.7407989502},{"name":"YXE","latitude":52.1707992554,"longitude":-106.699996948},{"name":"ARI","latitude":-18.348611,"longitude":-70.338889},{"name":"CCP","latitude":-36.8201,"longitude":-73.0444},{"name":"SCL","latitude":-33.3930015564,"longitude":-70.7857971191},{"name":"BOG","latitude":4.70159,"longitude":-74.1469},{"name":"MDE","latitude":6.16454,"longitude":-75.4231},{"name":"SJO","latitude":9.9938602448,"longitude":-84.2088012695},{"name":"ZAG","latitude":45.7429008484,"longitude":16.0687999725},{"name":"CUR","latitude":12.1888999939,"longitude":-68.9598007202},{"name":"LCA","latitude":34.8750991821,"longitude":33.6249008179},{"name":"PRG","latitude":50.1007995605,"longitude":14.2600002289},{"name":"CPH","latitude":55.6179008484,"longitude":12.6560001373},{"name":"JIB","latitude":11.5473003387,"longitude":43.1595001221},{"name":"SDQ","latitude":18.4297008514,"longitude":-69.6688995361},{"name":"GYE","latitude":-2.1894,"longitude":-79.8891},{"name":"UIO","latitude":-0.1291666667,"longitude":-78.3575},{"name":"TLL","latitude":59.4132995605,"longitude":24.8327999115},{"name":"HEL","latitude":60.317199707,"longitude":24.963300705},{"name":"MRS","latitude":43.439271922,"longitude":5.2214241028},{"name":"CDG","latitude":49.0127983093,"longitude":2.5499999523},{"name":"PPT","latitude":-17.5536994934,"longitude":-149.606994629},{"name":"TBS","latitude":41.6692008972,"longitude":44.95470047},{"name":"TXL","latitude":52.5597000122,"longitude":13.2876996994},{"name":"DUS","latitude":51.2895011902,"longitude":6.7667798996},{"name":"FRA","latitude":50.0264015198,"longitude":8.543129921},{"name":"HAM","latitude":53.6304016113,"longitude":9.9882297516},{"name":"MUC","latitude":48.3538017273,"longitude":11.7861003876},{"name":"STR","latitude":48.783333,"longitude":9.183333},{"name":"ACC","latitude":5.614818,"longitude":-0.205874},{"name":"ATH","latitude":37.9364013672,"longitude":23.9444999695},{"name":"SKG","latitude":40.5196990967,"longitude":22.9708995819},{"name":"GND","latitude":12.007116,"longitude":-61.7882288},{"name":"GUM","latitude":13.4834003448,"longitude":144.796005249},{"name":"GUA","latitude":14.5832996368,"longitude":-90.5274963379},{"name":"GEO","latitude":6.825648,"longitude":-58.163756},{"name":"PAP","latitude":18.5799999237,"longitude":-72.2925033569},{"name":"TGU","latitude":14.0608,"longitude":-87.2172},{"name":"HKG","latitude":22.3089008331,"longitude":113.915000916},{"name":"BUD","latitude":47.4369010925,"longitude":19.2555999756},{"name":"KEF","latitude":63.9850006104,"longitude":-22.6056003571},{"name":"AMD","latitude":23.0225,"longitude":72.5714},{"name":"BLR","latitude":13.7835719,"longitude":76.6165937},{"name":"BBI","latitude":20.2961,"longitude":85.8245},{"name":"IXC","latitude":30.673500061,"longitude":76.7884979248},{"name":"MAA","latitude":12.9900054932,"longitude":80.1692962646},{"name":"HYD","latitude":17.2313175201,"longitude":78.4298553467},{"name":"KNU","latitude":26.4499,"longitude":80.3319},{"name":"COK","latitude":9.9312,"longitude":76.2673},{"name":"CCU","latitude":22.6476933,"longitude":88.4349249},{"name":"BOM","latitude":19.0886993408,"longitude":72.8678970337},{"name":"NAG","latitude":21.1610714,"longitude":79.0024702},{"name":"DEL","latitude":28.5664997101,"longitude":77.1031036377},{"name":"PAT","latitude":25.591299057,"longitude":85.0879974365},{"name":"CGK","latitude":-6.1275229,"longitude":106.6515118},{"name":"JOG","latitude":-7.7881798744,"longitude":110.4319992065},{"name":"BGW","latitude":33.2625007629,"longitude":44.2346000671},{"name":"BSR","latitude":30.5491008759,"longitude":47.6621017456},{"name":"EBL","latitude":36.1901,"longitude":43.993},{"name":"NJF","latitude":31.989722,"longitude":44.404167},{"name":"XNH","latitude":30.9358005524,"longitude":46.0900993347},{"name":"ISU","latitude":35.5668,"longitude":45.4161},{"name":"ORK","latitude":51.8413009644,"longitude":-8.491109848},{"name":"DUB","latitude":53.4212989807,"longitude":-6.270070076},{"name":"HFA","latitude":32.78492,"longitude":34.96069},{"name":"TLV","latitude":32.0113983154,"longitude":34.8866996765},{"name":"MXP","latitude":45.6305999756,"longitude":8.7281103134},{"name":"PMO","latitude":38.16114,"longitude":13.31546},{"name":"FCO","latitude":41.8045005798,"longitude":12.2508001328},{"name":"KIN","latitude":17.9951,"longitude":-76.7846},{"name":"FUK","latitude":33.5902,"longitude":130.4017},{"name":"OKA","latitude":26.1958,"longitude":127.646},{"name":"KIX","latitude":34.4272994995,"longitude":135.244003296},{"name":"NRT","latitude":35.7647018433,"longitude":140.386001587},{"name":"AMM","latitude":31.7226009369,"longitude":35.9931983948},{"name":"ALA","latitude":43.3521003723,"longitude":77.0404968262},{"name":"MBA","latitude":-4.0348300934,"longitude":39.5942001343},{"name":"NBO","latitude":-1.319239974,"longitude":36.9277992249},{"name":"ICN","latitude":37.4691009521,"longitude":126.450996399},{"name":"KWI","latitude":29.226600647,"longitude":47.9688987732},{"name":"VTE","latitude":17.9757,"longitude":102.5683},{"name":"RIX","latitude":56.9235992432,"longitude":23.9710998535},{"name":"BEY","latitude":33.8208999634,"longitude":35.4883995056},{"name":"VNO","latitude":54.6341018677,"longitude":25.2858009338},{"name":"LUX","latitude":49.6265983582,"longitude":6.211520195},{"name":"MFM","latitude":22.1495990753,"longitude":113.592002869},{"name":"TNR","latitude":-18.91368,"longitude":47.53613},{"name":"JHB","latitude":1.635848,"longitude":103.665943},{"name":"KUL","latitude":2.745579958,"longitude":101.709999084},{"name":"MLE","latitude":4.1748,"longitude":73.50888},{"name":"MRU","latitude":-20.4302005768,"longitude":57.6836013794},{"name":"MEX","latitude":19.4363002777,"longitude":-99.0720977783},{"name":"QRO","latitude":20.6173000336,"longitude":-100.185997009},{"name":"KIV","latitude":46.9277000427,"longitude":28.9309997559},{"name":"ULN","latitude":47.8431015015,"longitude":106.766998291},{"name":"CMN","latitude":33.3675003052,"longitude":-7.5899701118},{"name":"MPM","latitude":-25.9207992554,"longitude":32.5726013184},{"name":"MDL","latitude":21.7051697,"longitude":95.9695206},{"name":"RGN","latitude":16.9073009491,"longitude":96.1332015991},{"name":"KTM","latitude":27.6965999603,"longitude":85.3591003418},{"name":"AMS","latitude":52.3086013794,"longitude":4.7638897896},{"name":"NOU","latitude":-22.0146007538,"longitude":166.212997436},{"name":"AKL","latitude":-37.0080986023,"longitude":174.792007446},{"name":"CHC","latitude":-43.4893989563,"longitude":172.5319976807},{"name":"LOS","latitude":6.5773701668,"longitude":3.321160078},{"name":"OSL","latitude":60.193901062,"longitude":11.100399971},{"name":"MCT","latitude":23.5932998657,"longitude":58.2844009399},{"name":"ISB","latitude":33.6166992188,"longitude":73.0991973877},{"name":"KHI","latitude":24.9064998627,"longitude":67.1607971191},{"name":"LHE","latitude":31.5216007233,"longitude":74.4036026001},{"name":"ZDM","latitude":32.2719,"longitude":35.0194},{"name":"PTY","latitude":9.0713596344,"longitude":-79.3834991455},{"name":"ASU","latitude":-25.2399997711,"longitude":-57.5200004578},{"name":"LIM","latitude":-12.021900177,"longitude":-77.1143035889},{"name":"CGY","latitude":8.4156198502,"longitude":124.611000061},{"name":"CEB","latitude":10.3074998856,"longitude":123.978996277},{"name":"MNL","latitude":14.508600235,"longitude":121.019996643},{"name":"WAW","latitude":52.1656990051,"longitude":20.9671001434},{"name":"LIS","latitude":38.7812995911,"longitude":-9.1359195709},{"name":"DOH","latitude":25.2605946,"longitude":51.6137665},{"name":"RUN","latitude":-20.8871002197,"longitude":55.5102996826},{"name":"OTP","latitude":44.5722007751,"longitude":26.1021995544},{"name":"KHV","latitude":48.5279998779,"longitude":135.18800354},{"name":"KJA","latitude":56.0153,"longitude":92.8932},{"name":"DME","latitude":55.4087982178,"longitude":37.9062995911},{"name":"LED","latitude":59.8003005981,"longitude":30.2625007629},{"name":"KLD","latitude":56.8587,"longitude":35.9176},{"name":"SVX","latitude":56.8431,"longitude":60.6454},{"name":"KGL","latitude":-1.9686299563,"longitude":30.1394996643},{"name":"DMM","latitude":26.471200943,"longitude":49.7979011536},{"name":"JED","latitude":21.679599762,"longitude":39.15650177},{"name":"RUH","latitude":24.9575996399,"longitude":46.6987991333},{"name":"DKR","latitude":14.7412099,"longitude":-17.4889771},{"name":"BEG","latitude":44.8184013367,"longitude":20.3090991974},{"name":"SIN","latitude":1.3501900434,"longitude":103.994003296},{"name":"BTS","latitude":48.1486,"longitude":17.1077},{"name":"CPT","latitude":-33.9648017883,"longitude":18.6016998291},{"name":"DUR","latitude":-29.6144444444,"longitude":31.1197222222},{"name":"JNB","latitude":-26.133333,"longitude":28.25},{"name":"BCN","latitude":41.2971000671,"longitude":2.0784599781},{"name":"MAD","latitude":40.4936,"longitude":-3.56676},{"name":"CMB","latitude":7.1807599068,"longitude":79.8841018677},{"name":"PBM","latitude":5.452831,"longitude":-55.187783},{"name":"GOT","latitude":57.6627998352,"longitude":12.279800415},{"name":"ARN","latitude":59.6519012451,"longitude":17.9186000824},{"name":"GVA","latitude":46.2380981445,"longitude":6.1089501381},{"name":"ZRH","latitude":47.4646987915,"longitude":8.5491695404},{"name":"KHH","latitude":22.5771007538,"longitude":120.3499984741},{"name":"TPE","latitude":25.0776996613,"longitude":121.233001709},{"name":"DAR","latitude":-6.8781099319,"longitude":39.2025985718},{"name":"BKK","latitude":13.6810998917,"longitude":100.747001648},{"name":"CNX","latitude":18.7667999268,"longitude":98.962600708},{"name":"URT","latitude":9.1325998306,"longitude":99.135597229},{"name":"TUN","latitude":36.8510017395,"longitude":10.2271995544},{"name":"IST","latitude":40.9768981934,"longitude":28.8145999908},{"name":"ADB","latitude":38.32377,"longitude":27.14317},{"name":"KBP","latitude":50.3450012207,"longitude":30.8946990967},{"name":"DXB","latitude":25.2527999878,"longitude":55.3643989563},{"name":"EDI","latitude":55.9500007629,"longitude":-3.3724999428},{"name":"LHR","latitude":51.4706001282,"longitude":-0.4619410038},{"name":"MAN","latitude":53.3536987305,"longitude":-2.2749500275},{"name":"MGM","latitude":32.30059814,"longitude":-86.39399719},{"name":"PHX","latitude":33.434299469,"longitude":-112.012001038},{"name":"LAX","latitude":33.94250107,"longitude":-118.4079971},{"name":"SMF","latitude":38.695400238,"longitude":-121.591003418},{"name":"SAN","latitude":32.7336006165,"longitude":-117.190002441},{"name":"SFO","latitude":37.6189994812,"longitude":-122.375},{"name":"SJC","latitude":37.3625984192,"longitude":-121.929000855},{"name":"DEN","latitude":39.8616981506,"longitude":-104.672996521},{"name":"JAX","latitude":30.4941005707,"longitude":-81.6878967285},{"name":"MIA","latitude":25.7931995392,"longitude":-80.2906036377},{"name":"TLH","latitude":30.3964996338,"longitude":-84.3503036499},{"name":"TPA","latitude":27.9755001068,"longitude":-82.533203125},{"name":"ATL","latitude":33.6366996765,"longitude":-84.4281005859},{"name":"HNL","latitude":21.3187007904,"longitude":-157.9219970703},{"name":"ORD","latitude":41.97859955,"longitude":-87.90480042},{"name":"IND","latitude":39.717300415,"longitude":-86.2944030762},{"name":"BOS","latitude":42.36429977,"longitude":-71.00520325},{"name":"DTW","latitude":42.2123985291,"longitude":-83.3534011841},{"name":"MSP","latitude":44.8819999695,"longitude":-93.2218017578},{"name":"MCI","latitude":39.2975997925,"longitude":-94.7138977051},{"name":"STL","latitude":38.7486991882,"longitude":-90.3700027466},{"name":"OMA","latitude":41.3031997681,"longitude":-95.8940963745},{"name":"LAS","latitude":36.08010101,"longitude":-115.1520004},{"name":"EWR","latitude":40.6925010681,"longitude":-74.1687011719},{"name":"BUF","latitude":42.94049835,"longitude":-78.73220062},{"name":"CLT","latitude":35.2140007019,"longitude":-80.9430999756},{"name":"CMH","latitude":39.9980010986,"longitude":-82.8918991089},{"name":"PDX","latitude":45.58869934,"longitude":-122.5979996},{"name":"PHL","latitude":39.8718986511,"longitude":-75.2410964966},{"name":"PIT","latitude":40.49150085,"longitude":-80.23290253},{"name":"FSD","latitude":43.540819819502,"longitude":-96.65511577730963},{"name":"MEM","latitude":35.0424003601,"longitude":-89.9766998291},{"name":"BNA","latitude":36.1245002747,"longitude":-86.6781997681},{"name":"DFW","latitude":32.8968009949,"longitude":-97.0380020142},{"name":"IAH","latitude":29.9843997955,"longitude":-95.3414001465},{"name":"MFE","latitude":26.17580032,"longitude":-98.23860168},{"name":"SLC","latitude":40.7883987427,"longitude":-111.977996826},{"name":"IAD","latitude":38.94449997,"longitude":-77.45580292},{"name":"ORF","latitude":36.8945999146,"longitude":-76.2012023926},{"name":"RIC","latitude":37.5051994324,"longitude":-77.3197021484},{"name":"SEA","latitude":47.4490013123,"longitude":-122.308998108},{"name":"TAS","latitude":41.257900238,"longitude":69.2811965942},{"name":"HAN","latitude":21.221200943,"longitude":105.806999206},{"name":"SGN","latitude":10.8187999725,"longitude":106.652000427},{"name":"HRE","latitude":-17.9318008423,"longitude":31.0928001404}];

var map = new Datamap({
	element: document.getElementById('worldmap'),
	scope: 'world',
	responsive: true,
	fills: {
		'POINT': '#4f46e5',
		'CONNECTED': '#f7931a',
		defaultFill: '#3f3d56'
	},
	geographyConfig: {
		popupOnHover: false,
		highlightOnHover: false
	},
	bubblesConfig: {
		fillKey: 'POINT',
		borderWidth: 1,
		borderColor: '#FFFFFF',
		radius: 5,
		highlightFillColor: '#FC8D59',
	}
});

map.addPlugin('fadingBubbles', fadingBubbles);

fetch('https://dns.rabbitdns.org/cdn-cgi/trace').then((response) => response.text()).then((data) => {
	var colo = data.match(/^colo=(.+)/m)[1];
	markColo(colo);
}).catch(() => {
	map.bubbles(servers, {});
});

function markColo(colo){
	let index = 0;
	for(let i = 0; i < servers.length; i++){
		if(servers[i].name === colo){
			index = i;
			servers[i].fillKey = 'CONNECTED';
			break;
		}
	}
	servers.push(servers.splice(index, 1)[0]);
	map.bubbles(servers, {});
	setInterval(() => {
		if(document.hasFocus()) map.fadingBubbles([servers[servers.length-1]]);
	}, 5000);
}

window.addEventListener("resize", () => map.resize());